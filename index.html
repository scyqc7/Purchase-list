<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‡è´­æ¸…å•åä½œç³»ç»Ÿï¼ˆFirebaseå®æ—¶åŒæ­¥ï¼‰</title>
    <!-- Firebase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.22.2/compat/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.22.2/compat/database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fa; margin: 0; }
        .container { max-width: 900px; margin: 30px auto; background: #fff; border-radius: 8px; box-shadow: 0 0 10px #ddd; padding: 30px; }
        h2, h4 { color: #007bff; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #007bff; color: #fff; }
        .btn { padding: 6px 16px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: #fff; }
        .btn-danger { background: #dc3545; color: #fff; }
        .btn-secondary { background: #6c757d; color: #fff; }
        .btn-warning { background: #ffc107; color: #000; }
        .archived-modal { position: fixed; top: 5%; left: 10%; width: 80%; height: 80%; background: #fff; border: 2px solid #007bff; border-radius: 8px; z-index: 9999; overflow: auto; box-shadow: 0 0 20px #007bff55; display: none; }
        .archived-modal-content { padding: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>é‡‡è´­æ¸…å•åä½œç³»ç»Ÿï¼ˆFirebaseå®æ—¶åŒæ­¥ï¼‰</h2>
        <div>
            <label>æ·»åŠ äººé‚®ç®± | Email: <input id="useremail" type="email" style="margin-right:10px;"></label>
            <button class="btn btn-primary" onclick="login()">åŠ å…¥åä½œ | Join</button>
            <span id="userInfo"></span>
        </div>
        <hr>
        <div id="mainArea" style="display:none;">
            <h4>å½“å‰é‡‡è´­æ¸…å• | Current Purchase List</h4>
            <form onsubmit="addItem(event)">
                <input id="itemFiller" placeholder="å¡«å†™äºº | Filler" required style="width:120px;">
                <input id="itemName" placeholder="å•†å“åç§° | Product Name" required>
                <input id="itemQuantity" type="number" min="1" placeholder="æ•°é‡ | Quantity" required style="width:70px;">
                <input id="itemPrice" type="number" min="0.01" step="0.01" placeholder="å•ä»· | Unit Price" required style="width:90px;">
                <input id="itemLink" placeholder="å•†å“é“¾æ¥ | Product Link">
                <input id="itemPriority" placeholder="ä¼˜å…ˆçº§ | Priority" value="medium" style="width:80px;">
                <input id="itemNotes" placeholder="å¤‡æ³¨ | Notes">
                <button class="btn btn-primary" type="submit">æ·»åŠ  | Add</button>
            </form>
            <div style="margin: 8px 0 16px 0; color: #dc3545; font-weight: bold;">æ™®é€šé˜Ÿå‘˜æˆªè‡³æ­¤æ­¥ä¸ºæ­¢</div>
            <table id="purchaseTable">
                <thead>
                    <tr>
                        <th>å¡«å†™äºº | Filler</th><th>å•†å“åç§° | Product Name</th><th>æ•°é‡ | Quantity</th><th>å•ä»· | Unit Price</th><th>æ€»ä»· | Total Price</th><th>å•†å“é“¾æ¥ | Product Link</th><th>ä¼˜å…ˆçº§ | Priority</th><th>å¤‡æ³¨ | Notes</th><th>æ·»åŠ äººé‚®ç®± | Email</th><th>æ“ä½œ | Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div style="margin:10px 0;">
                <b>æ€»é‡‘é¢ | Total: <span id="totalAmount">0.00</span> å…ƒ</b>
            </div>
            <div>
                <b>å‘¨æœŸå¼€å§‹ | Period Start:</b> <span id="periodStart"></span>
                <b>ä¸‹æ¬¡å½’æ¡£ | Next Archive:</b> <span id="nextArchive"></span>
                <button class="btn btn-secondary" onclick="forceArchive()">ç«‹å³å½’æ¡£ | Archive Now</button>
            </div>
            <div style="margin-top:20px;">
                <button class="btn btn-primary" onclick="showArchivedLists()">ğŸ—‚ï¸ æŸ¥çœ‹å†å²é‡‡è´­åˆ—è¡¨ | View Archived Lists</button>
                <button class="btn btn-warning" onclick="exportCurrentListExcel()">ğŸ“¤ å¯¼å‡ºé‡‡è´­å• | Export to Excel</button>
                <button class="btn btn-secondary" onclick="showAuditEntry()">ğŸ“ å®¡æ ¸å†å²é‡‡è´­å• | Audit Archived List</button>
            </div>
        </div>
    </div>
    <!-- å†å²é‡‡è´­åˆ—è¡¨å¼¹çª— -->
    <div class="archived-modal" id="archivedListsArea">
        <div class="archived-modal-content">
            <button class="btn btn-secondary" onclick="closeArchivedListsView()">å…³é—­ | Close</button>
            <h4>å†å²é‡‡è´­åˆ—è¡¨ | Archived Purchase Lists</h4>
            <div id="archivedListsContent"></div>
        </div>
    </div>
    <!-- å®¡æ ¸å¼¹çª— -->
    <div class="archived-modal" id="auditArea">
        <div class="archived-modal-content">
            <button class="btn btn-secondary" onclick="closeAuditView()">å…³é—­ | Close</button>
            <h4>å®¡æ ¸å†å²é‡‡è´­å• | Audit Archived List</h4>
            <div id="auditSelectArea"></div>
            <div id="auditTableArea"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script>
        // ====== Firebase é…ç½®ä¸åˆå§‹åŒ– ======
        const firebaseConfig = {
            apiKey: "AIzaSyAxzDkV5O621f3pVKdQN7PZ9KPbLSljG5E",
            authDomain: "purchaselist-7891f.firebaseapp.com",
            databaseURL: "https://purchaselist-7891f-default-rtdb.firebaseio.com",
            projectId: "purchaselist-7891f",
            storageBucket: "purchaselist-7891f.firebasestorage.app",
            messagingSenderId: "887629105138",
            appId: "1:887629105138:web:1dd1c587684216721ccd6b",
            measurementId: "G-6BZB8CFNTZ"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ====== å…¨å±€å˜é‡ ======
        let currentUser = null;
        let periodStart = null;
        let purchaseList = [];
        let archiveTimer = null;

        // ====== ç™»å½• ======
        function login() {
            const email = document.getElementById('useremail').value.trim();
            if (!email) { alert('è¯·è¾“å…¥é‚®ç®±'); return; }
            currentUser = email;
            document.getElementById('userInfo').textContent = `å½“å‰ç”¨æˆ·: ${email}`;
            document.getElementById('mainArea').style.display = '';
            loadCurrentList();
        }

        // ====== é‡‡è´­æ¸…å•æ“ä½œ ======
        function addItem(e) {
            e.preventDefault();
            if (!currentUser) return;
            const filler = document.getElementById('itemFiller').value.trim();
            const name = document.getElementById('itemName').value.trim();
            const quantity = parseInt(document.getElementById('itemQuantity').value);
            const price = parseFloat(document.getElementById('itemPrice').value);
            const link = document.getElementById('itemLink').value.trim();
            const priority = document.getElementById('itemPriority').value.trim();
            const notes = document.getElementById('itemNotes').value.trim();
            if (!filler || !name || !quantity || !price) { alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ | Please fill all fields'); return; }
            const item = {
                filler, name, quantity, price, total: +(quantity * price).toFixed(2), link, priority, notes,
                addedBy: currentUser, addedAt: dayjs().format('YYYY-MM-DD HH:mm:ss')
            };
            purchaseList.push(item);
            db.ref('purchaseList/current').set({
                items: purchaseList,
                periodStart: periodStart
            });
            clearForm();
        }

        function deleteItem(idx) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¯¥å•†å“ï¼Ÿ')) return;
            purchaseList.splice(idx, 1);
            db.ref('purchaseList/current').set({
                items: purchaseList,
                periodStart: periodStart
            });
        }

        function clearForm() {
            document.getElementById('itemFiller').value = '';
            document.getElementById('itemName').value = '';
            document.getElementById('itemQuantity').value = '';
            document.getElementById('itemPrice').value = '';
            document.getElementById('itemLink').value = '';
            document.getElementById('itemPriority').value = 'medium';
            document.getElementById('itemNotes').value = '';
        }

        // ====== å®æ—¶ç›‘å¬å½“å‰é‡‡è´­æ¸…å• ======
        function loadCurrentList() {
            db.ref('purchaseList/current').on('value', snapshot => {
                const data = snapshot.val();
                purchaseList = data && data.items ? data.items : [];
                periodStart = data && data.periodStart ? data.periodStart : dayjs().format('YYYY-MM-DD');
                renderPurchaseTable();
                updatePeriodStatus();
                checkAndAutoArchive();
            });
        }

        function renderPurchaseTable() {
            const tbody = document.querySelector('#purchaseTable tbody');
            tbody.innerHTML = '';
            let total = 0;
            purchaseList.forEach((item, idx) => {
                total += item.total;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.filler}</td>
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>${item.price}</td>
                    <td>${item.total}</td>
                    <td><a href="${item.link}" target="_blank">${item.link ? 'é“¾æ¥ | Link' : ''}</a></td>
                    <td>${item.priority}</td>
                    <td>${item.notes}</td>
                    <td>${item.addedBy}</td>
                    <td><button class="btn btn-danger" onclick="deleteItem(${idx})">åˆ é™¤ | Delete</button></td>
                `;
                tbody.appendChild(tr);
            });
            document.getElementById('totalAmount').textContent = total.toFixed(2);
        }

        // ====== å‘¨æœŸå½’æ¡£ä¸çŠ¶æ€ ======
        function updatePeriodStatus() {
            document.getElementById('periodStart').textContent = periodStart;
            const nextArchive = dayjs(periodStart).add(14, 'day').format('YYYY-MM-DD');
            document.getElementById('nextArchive').textContent = nextArchive;
        }

        function checkAndAutoArchive() {
            if (!periodStart) return;
            const now = dayjs();
            const start = dayjs(periodStart);
            if (now.diff(start, 'day') >= 14) {
                forceArchive();
            }
        }

        function forceArchive() {
            if (purchaseList.length === 0) {
                // åªé‡ç½®å‘¨æœŸ
                periodStart = dayjs().format('YYYY-MM-DD');
                db.ref('purchaseList/current').set({ items: [], periodStart });
                return;
            }
            // å½’æ¡£
            const archiveId = Date.now();
            db.ref('purchaseList/history/' + archiveId).set({
                items: purchaseList,
                periodStart: periodStart,
                periodEnd: dayjs().format('YYYY-MM-DD'),
                archivedAt: dayjs().format('YYYY-MM-DD HH:mm:ss')
            }, () => {
                // æ¸…ç©ºå½“å‰
                periodStart = dayjs().format('YYYY-MM-DD');
                db.ref('purchaseList/current').set({ items: [], periodStart });
            });
        }

        // ====== å†å²é‡‡è´­åˆ—è¡¨ ======
        function showArchivedLists() {
            console.log('showArchivedLists called');
            db.ref('purchaseList/history').once('value').then(snapshot => {
                const data = snapshot.val() || {};
                const content = document.getElementById('archivedListsContent');
                content.innerHTML = '';
                const keys = Object.keys(data).sort((a, b) => b - a);
                if (keys.length === 0) {
                    content.innerHTML = '<div style="color:#888;">æš‚æ— å†å²é‡‡è´­åˆ—è¡¨ | No archived purchase lists.</div>';
                } else {
                    keys.forEach((key, idx) => {
                        const period = data[key];
                        const div = document.createElement('div');
                        div.style = 'margin-bottom:18px; border-bottom:1px solid #eee; padding-bottom:10px;';
                        div.innerHTML = `<b>å‘¨æœŸ ${idx + 1}</b> <br>å¼€å§‹ | Start: ${period.periodStart || ''}<br>ç»“æŸ | End: ${period.periodEnd || ''}<br>å½’æ¡£æ—¶é—´ | Archived: ${period.archivedAt || ''}<br>å•†å“æ•° | Items: ${(period.items || []).length}<br><button class="view-archived-btn btn btn-primary" data-key="${key}">æŸ¥çœ‹è¯¦æƒ… | View Details</button> <button class="export-archived-btn btn btn-success" data-key="${key}">å¯¼å‡ºExcel | Export Excel</button> <button class="delete-archived-btn btn btn-danger" data-key="${key}">åˆ é™¤ | Delete</button>`;
                        content.appendChild(div);
                    });
                }
                document.getElementById('archivedListsArea').style.display = 'block';
            });
        }

        function closeArchivedListsView() {
            document.getElementById('archivedListsArea').style.display = 'none';
        }

        function viewArchivedTable(key) {
            console.log('viewArchivedTable called', key);
            db.ref('purchaseList/history/' + key).once('value').then(snapshot => {
                const period = snapshot.val();
                let html = `<h4>å‘¨æœŸè¯¦æƒ… | Cycle Detail</h4><div>å¼€å§‹ | Start: ${period.periodStart || ''}<br>ç»“æŸ | End: ${period.periodEnd || ''}<br>å½’æ¡£æ—¶é—´ | Archived: ${period.archivedAt || ''}<br>å•†å“æ•° | Items: ${period.items ? period.items.length : 0}</div><table border='1' style='width:100%;margin-top:10px;'><thead><tr><th>å¡«å†™äºº | Filler</th><th>å•†å“åç§° | Product Name</th><th>æ•°é‡ | Quantity</th><th>å•ä»· | Unit Price</th><th>æ€»ä»· | Total Price</th><th>å•†å“é“¾æ¥ | Product Link</th><th>ä¼˜å…ˆçº§ | Priority</th><th>å¤‡æ³¨ | Notes</th><th>æ·»åŠ äººé‚®ç®± | Email</th><th>æ·»åŠ æ—¶é—´ | Added At</th></tr></thead><tbody>`;
                (period.items || []).forEach(item => {
                    html += `<tr><td>${item.filler || ''}</td><td>${item.name || ''}</td><td>${item.quantity || ''}</td><td>${item.price || ''}</td><td>${item.total || ''}</td><td>${item.link || ''}</td><td>${item.priority || ''}</td><td>${item.notes || ''}</td><td>${item.addedBy || ''}</td><td>${item.addedAt || ''}</td></tr>`;
                });
                html += '</tbody></table>';
                document.getElementById('archivedListsContent').innerHTML = html;
            });
        }

        function deleteArchivedList(key) {
            console.log('deleteArchivedList called', key);
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¯¥å†å²é‡‡è´­åˆ—è¡¨ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼ | Are you sure to delete this archived list?')) return;
            db.ref('purchaseList/history/' + key).remove(() => {
                showArchivedLists();
            });
        }

        function exportArchivedExcel(key) {
            db.ref('purchaseList/history/' + key).once('value').then(snapshot => {
                const period = snapshot.val();
                if (!period || !period.items || period.items.length === 0) {
                    alert('è¯¥å‘¨æœŸæ— é‡‡è´­æ•°æ® | No data in this cycle');
                    return;
                }
                const wsData = [
                    ['å¡«å†™äºº | Filler','å•†å“åç§° | Product Name','æ•°é‡ | Quantity','å•ä»· | Unit Price','æ€»ä»· | Total Price','å•†å“é“¾æ¥ | Product Link','ä¼˜å…ˆçº§ | Priority','å¤‡æ³¨ | Notes','æ·»åŠ äººé‚®ç®± | Email','æ·»åŠ æ—¶é—´ | Added At']
                ];
                (period.items || []).forEach(item => {
                    wsData.push([
                        item.filler || '', item.name || '', item.quantity || '', item.price || '', item.total || '', item.link || '', item.priority || '', item.notes || '', item.addedBy || '', item.addedAt || ''
                    ]);
                });
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'å†å²é‡‡è´­å• | Archived List');
                XLSX.writeFile(wb, `å†å²é‡‡è´­å•_Archived_${period.periodStart || ''}_${period.periodEnd || ''}.xlsx`);
            });
        }

        // ====== å¯¼å‡ºé‡‡è´­å•ä¸ºExcel ======
        function exportCurrentListExcel() {
            if (!purchaseList || purchaseList.length === 0) {
                alert('å½“å‰é‡‡è´­å•ä¸ºç©ºï¼ | The purchase list is empty!');
                return;
            }
            const wsData = [
                ['å¡«å†™äºº | Filler','å•†å“åç§° | Product Name','æ•°é‡ | Quantity','å•ä»· | Unit Price','æ€»ä»· | Total Price','å•†å“é“¾æ¥ | Product Link','ä¼˜å…ˆçº§ | Priority','å¤‡æ³¨ | Notes','æ·»åŠ äººé‚®ç®± | Email','æ·»åŠ æ—¶é—´ | Added At']
            ];
            purchaseList.forEach(item => {
                wsData.push([
                    item.filler, item.name, item.quantity, item.price, item.total, item.link, item.priority, item.notes, item.addedBy, item.addedAt
                ]);
            });
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'é‡‡è´­å• | Purchase List');
            XLSX.writeFile(wb, `é‡‡è´­å•_PurchaseList_${dayjs().format('YYYYMMDD_HHmmss')}.xlsx`);
        }

        // ====== å®¡æ ¸å†å²é‡‡è´­å• ======
        let auditHistoryData = {};
        let auditCurrentKey = null;
        let auditChecked = [];

        function showAuditEntry() {
            console.log('showAuditEntry called');
            db.ref('purchaseList/history').once('value').then(snapshot => {
                auditHistoryData = snapshot.val() || {};
                const keys = Object.keys(auditHistoryData).sort((a, b) => b - a);
                const selectArea = document.getElementById('auditSelectArea');
                selectArea.innerHTML = '';
                if (keys.length === 0) {
                    selectArea.innerHTML = '<div style="color:#888;">æš‚æ— å†å²é‡‡è´­åˆ—è¡¨</div>';
                } else {
                    let html = '<select id="auditSelect" onchange="renderAuditTable(this.value)"><option value="">é€‰æ‹©å†å²é‡‡è´­å•</option>';
                    keys.forEach(key => {
                        const period = auditHistoryData[key];
                        html += `<option value="${key}">${period.periodStart || ''} ~ ${period.periodEnd || ''}ï¼ˆ${(period.items || []).length}é¡¹ï¼‰</option>`;
                    });
                    html += '</select>';
                    selectArea.innerHTML = html;
                }
                document.getElementById('auditTableArea').innerHTML = '';
                document.getElementById('auditArea').style.display = 'block';
            });
        }

        function closeAuditView() {
            console.log('closeAuditView called');
            document.getElementById('auditArea').style.display = 'none';
        }

        function renderAuditTable(key) {
            console.log('renderAuditTable called', key);
            auditCurrentKey = key;
            auditChecked = [];
            if (!key || !auditHistoryData[key]) {
                document.getElementById('auditTableArea').innerHTML = '';
                return;
            }
            const period = auditHistoryData[key];
            let html = `<table border='1' style='width:100%;margin-top:10px;'><thead><tr><th>åŒæ„ | Approve</th><th>å¡«å†™äºº | Filler</th><th>å•†å“åç§° | Product Name</th><th>æ•°é‡ | Quantity</th><th>å•ä»· | Unit Price</th><th>æ€»ä»· | Total Price</th><th>å•†å“é“¾æ¥ | Product Link</th><th>ä¼˜å…ˆçº§ | Priority</th><th>å¤‡æ³¨ | Notes</th><th>æ·»åŠ äººé‚®ç®± | Email</th><th>æ·»åŠ æ—¶é—´ | Added At</th></tr></thead><tbody>`;
            (period.items || []).forEach((item, idx) => {
                html += `<tr><td><input type='checkbox' checked onchange='auditCheckChange(${idx}, this.checked)'></td><td>${item.filler || ''}</td><td>${item.name || ''}</td><td>${item.quantity || ''}</td><td>${item.price || ''}</td><td>${item.total || ''}</td><td>${item.link || ''}</td><td>${item.priority || ''}</td><td>${item.notes || ''}</td><td>${item.addedBy || ''}</td><td>${item.addedAt || ''}</td></tr>`;
                auditChecked[idx] = true;
            });
            html += '</tbody></table>';
            html += `<button class='btn btn-primary' onclick='exportAuditExcel()'>å¯¼å‡ºå®¡æ ¸é€šè¿‡å•†å“ | Export Approved</button> <button class='btn btn-danger' onclick='removeDisagreedItems()'>æ¸…é™¤ä¸åŒæ„å•†å“ | Remove Disagreed</button>`;
            document.getElementById('auditTableArea').innerHTML = html;
        }

        function auditCheckChange(idx, checked) {
            console.log('auditCheckChange called', idx, checked);
            auditChecked[idx] = checked;
        }

        function exportAuditExcel() {
            console.log('exportAuditExcel called');
            if (!auditCurrentKey || !auditHistoryData[auditCurrentKey]) return;
            const period = auditHistoryData[auditCurrentKey];
            const wsData = [
                ['å¡«å†™äºº | Filler','å•†å“åç§° | Product Name','æ•°é‡ | Quantity','å•ä»· | Unit Price','æ€»ä»· | Total Price','å•†å“é“¾æ¥ | Product Link','ä¼˜å…ˆçº§ | Priority','å¤‡æ³¨ | Notes','æ·»åŠ äººé‚®ç®± | Email','æ·»åŠ æ—¶é—´ | Added At']
            ];
            (period.items || []).forEach((item, idx) => {
                if (auditChecked[idx]) {
                    wsData.push([
                        item.filler || '', item.name || '', item.quantity || '', item.price || '', item.total || '', item.link || '', item.priority || '', item.notes || '', item.addedBy || '', item.addedAt || ''
                    ]);
                }
            });
            if (wsData.length === 1) { alert('æ²¡æœ‰å®¡æ ¸é€šè¿‡çš„å•†å“ï¼ | No approved items!'); return; }
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'å®¡æ ¸é€šè¿‡å•†å“ | Approved Items');
            XLSX.writeFile(wb, `å®¡æ ¸é€šè¿‡å•†å“_Approved_${dayjs().format('YYYYMMDD_HHmmss')}.xlsx`);
        }

        function removeDisagreedItems() {
            console.log('removeDisagreedItems called');
            if (!auditCurrentKey || !auditHistoryData[auditCurrentKey]) return;
            const period = auditHistoryData[auditCurrentKey];
            const newItems = (period.items || []).filter((item, idx) => auditChecked[idx]);
            if (newItems.length === (period.items || []).length) { alert('æ²¡æœ‰ä¸åŒæ„å•†å“ï¼Œæ— éœ€æ¸…é™¤'); return; }
            if (!confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ä¸åŒæ„å•†å“ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
            db.ref('purchaseList/history/' + auditCurrentKey + '/items').set(newItems, () => {
                alert('å·²æ¸…é™¤æ‰€æœ‰ä¸åŒæ„å•†å“ï¼');
                showAuditEntry();
            });
        }

        // äº‹ä»¶å§”æ‰˜ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('archivedListsContent').addEventListener('click', function(e) {
                if (e.target.classList.contains('view-archived-btn')) {
                    viewArchivedTable(e.target.dataset.key);
                }
                if (e.target.classList.contains('delete-archived-btn')) {
                    deleteArchivedList(e.target.dataset.key);
                }
                if (e.target.classList.contains('export-archived-btn')) {
                    exportArchivedExcel(e.target.dataset.key);
                }
            });
        });

        // å°†æ‰€æœ‰å¼¹çª—å’Œå†å²/å®¡æ ¸ç›¸å…³å‡½æ•°æŒ‚è½½åˆ°windowï¼Œç¡®ä¿æŒ‰é’®ç‚¹å‡»å¿…å®šæœ‰å“åº”
        window.showArchivedLists = showArchivedLists;
        window.viewArchivedTable = viewArchivedTable;
        window.deleteArchivedList = deleteArchivedList;
        window.showAuditEntry = showAuditEntry;
        window.renderAuditTable = renderAuditTable;
        window.closeAuditView = closeAuditView;
        window.auditCheckChange = auditCheckChange;
        window.exportAuditExcel = exportAuditExcel;
        window.exportArchivedExcel = exportArchivedExcel;
        window.removeDisagreedItems = removeDisagreedItems;
        // === æ–°å¢å…¨å±€æŒ‚è½½ï¼Œç¡®ä¿æŒ‰é’®å¯ç”¨ ===
        window.login = login;
        window.addItem = addItem;
        window.forceArchive = forceArchive;
        window.exportCurrentListExcel = exportCurrentListExcel;
        window.closeArchivedListsView = closeArchivedListsView;
    </script>
</body>
</html>